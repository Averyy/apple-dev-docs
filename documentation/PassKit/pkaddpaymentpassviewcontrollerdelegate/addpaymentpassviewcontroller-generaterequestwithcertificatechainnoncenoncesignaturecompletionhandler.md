# addPaymentPassViewController(_:generateRequestWithCertificateChain:nonce:nonceSignature:completionHandler:)

**Framework**: PassKit (Apple Pay and Wallet)  
**Kind**: method  
**Required**: Yes

Asks the delegate to create an add payment request.

**Availability**:
- iOS 9.0+
- iPadOS 9.0+
- Mac Catalyst 13.1+
- visionOS 1.0+

## Declaration

```swift
func addPaymentPassViewController(_ controller: PKAddPaymentPassViewController, generateRequestWithCertificateChain certificates: [Data], nonce: Data, nonceSignature: Data) async -> PKAddPaymentPassRequest
```

#### Discussion

This method provides the data needed to create an add payment request. Pass the certificate chain to the issuer server. The server returns an encrypted JSON file containing the card data. After you receive the encrypted data, create a add payment request and call the handler.

For more information on the encrypted card data, see [`encryptedPassData`](pkaddpaymentpassrequest/encryptedpassdata.md) in [`PKAddPaymentPassRequest`](pkaddpaymentpassrequest.md).

> ❗ **Important**:  Do not encrypt the card data on the device. You should encrypt the data on your server, and then pass the encrypted data to the device.

 Do not encrypt the card data on the device. You should encrypt the data on your server, and then pass the encrypted data to the device.

## Parameters

- `controller`: The view controller asking for the add payment request.
- `certificates`: An array of NSData objects. Each object contains a DER encoded X.509 certificate, with the leaf first and root last. You must download the root CA to validate the entire chain.
- `nonce`: A one-time nonce value generated by Apple’s servers. This nonce must be included in the add payment request’s encrypted data.
- `nonceSignature`: The device-specific signature for the nonce.This signature must be included in the add payment request’s encrypted data.
- `handler`: A completion handler. Call this block after you have created your add payment request.

## See Also

- [class PKAddPaymentPassRequest](pkaddpaymentpassrequest.md)
  Contains the card data needed to add a card to Apple Pay.
- [func addPaymentPassViewController(PKAddPaymentPassViewController, didFinishAdding: PKPaymentPass?, error: (any Error)?)](pkaddpaymentpassviewcontrollerdelegate/addpaymentpassviewcontroller(_:didfinishadding:error:).md)


---

*[View on Apple Developer](https://developer.apple.com/documentation/passkit/pkaddpaymentpassviewcontrollerdelegate/addpaymentpassviewcontroller(_:generaterequestwithcertificatechain:nonce:noncesignature:completionhandler:))*